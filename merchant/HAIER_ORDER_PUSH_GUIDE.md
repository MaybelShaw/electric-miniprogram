# 商户后台 - 海尔订单推送功能使用指南

## 功能概述

在商户后台的订单管理页面，管理员可以手动推送海尔产品订单到海尔系统，并查询物流信息。

## 功能特性

### 1. 自动识别海尔订单

- 系统会自动识别包含海尔产品的订单
- 在订单列表中显示"海尔订单"标签
- 显示推送状态（已推送/未推送）

### 2. 手动推送订单

- 仅对已支付且未推送的海尔订单显示"推送海尔"按钮
- 推送时可以配置订单来源系统和店铺名称
- 推送成功后自动更新订单状态

### 3. 查询物流信息

- 已推送的海尔订单可以查询物流信息
- 显示统仓云仓物流、智汇宝物流和第三方快递信息
- 实时查询最新物流状态

## 使用步骤

### 步骤1：查看订单列表

1. 登录商户后台
2. 进入"订单管理"页面
3. 查看订单列表

**订单列表显示：**
- 订单号
- 用户信息
- 商品信息
- 订单状态
- **海尔订单标识**（是/否）
- **推送状态**（已推送/未推送）

### 步骤2：推送海尔订单

**条件：**
- 订单包含海尔产品（product_code不为空）
- 订单状态为"已支付"
- 订单尚未推送到海尔

**操作：**
1. 找到符合条件的订单
2. 点击"推送海尔"按钮
3. 在弹出的对话框中填写：
   - 订单来源系统（默认：MERCHANT_ADMIN）
   - 店铺名称（默认：默认店铺）
4. 确认订单信息无误
5. 点击"确定"推送

**推送成功后：**
- 订单的"海尔订单"列显示"已推送"
- 订单详情中显示海尔订单号和子订单号
- "推送海尔"按钮消失，显示"查询物流"按钮

### 步骤3：查询物流信息

**条件：**
- 订单已推送到海尔系统

**操作：**
1. 找到已推送的海尔订单
2. 点击"查询物流"按钮
3. 查看物流信息：
   - 统仓云仓物流
   - 智汇宝物流
   - 第三方快递信息

### 步骤4：查看订单详情

点击"查看"按钮，可以看到：
- 基本订单信息
- 海尔订单标识
- 海尔订单号（如已推送）
- 海尔子订单号（如已推送）
- 物流公司和物流单号（如有）

## 界面说明

### 订单列表

```
┌─────────────────────────────────────────────────────────────────┐
│ 订单号 │ 用户 │ 商品 │ 金额 │ 状态 │ 海尔订单 │ 操作           │
├─────────────────────────────────────────────────────────────────┤
│ 123... │ 张三 │ 海尔 │ 2999 │ 已支付│ 是       │ 查看 推送海尔  │
│        │      │ 冰箱 │      │      │ 未推送   │ 发货 取消      │
├─────────────────────────────────────────────────────────────────┤
│ 456... │ 李四 │ 海尔 │ 1999 │ 已支付│ 是       │ 查看 查询物流  │
│        │      │ 洗衣 │      │      │ 已推送   │ 发货 取消      │
├─────────────────────────────────────────────────────────────────┤
│ 789... │ 王五 │ 普通 │ 999  │ 已支付│ 否       │ 查看 发货      │
│        │      │ 商品 │      │      │          │ 取消           │
└─────────────────────────────────────────────────────────────────┘
```

### 推送对话框

```
┌─────────────────────────────────────┐
│ 推送订单到海尔                       │
├─────────────────────────────────────┤
│ 订单来源系统: [MERCHANT_ADMIN    ]  │
│ 店铺名称:     [默认店铺          ]  │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 订单信息：                       │ │
│ │ 订单号: 1234567890123456        │ │
│ │ 商品: 海尔冰箱BCD-215STPH       │ │
│ │ 数量: 1                         │ │
│ │ 金额: ¥2999.00                  │ │
│ └─────────────────────────────────┘ │
│                                     │
│           [取消]  [确定]            │
└─────────────────────────────────────┘
```

### 物流信息对话框

```
┌─────────────────────────────────────┐
│ 海尔物流信息                         │
├─────────────────────────────────────┤
│ 统仓云仓物流                         │
│ ┌─────────────────────────────────┐ │
│ │ {                               │ │
│ │   "orderCode": "SO.xxx",        │ │
│ │   "logisticsNo": "SF123456",    │ │
│ │   "status": "已发货"            │ │
│ │ }                               │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 智汇宝物流                           │
│ ┌─────────────────────────────────┐ │
│ │ ...                             │ │
│ └─────────────────────────────────┘ │
│                                     │
│                [关闭]               │
└─────────────────────────────────────┘
```

## 注意事项

### 1. 推送条件

- ✅ 必须是海尔产品订单
- ✅ 订单状态必须是"已支付"
- ✅ 订单尚未推送到海尔
- ❌ 普通商品订单不显示推送按钮
- ❌ 未支付订单不能推送
- ❌ 已推送订单不能重复推送

### 2. 推送参数

**订单来源系统（source_system）：**
- 用于标识订单来源
- 建议使用：MERCHANT_ADMIN
- 可以自定义，但要保持一致

**店铺名称（shop_name）：**
- 用于标识店铺
- 建议使用实际店铺名称
- 例如：XX旗舰店、XX专卖店

### 3. 推送失败处理

如果推送失败，可能的原因：
- 海尔API配置错误
- 网络连接问题
- 订单数据不完整
- 海尔系统异常

**解决方法：**
1. 检查错误提示信息
2. 确认订单信息完整（地址、联系方式等）
3. 稍后重试
4. 联系技术支持

### 4. 物流查询

- 只有已推送的订单才能查询物流
- 物流信息可能有延迟
- 如果没有物流信息，说明海尔还未发货

## 常见问题

### Q1: 为什么看不到"推送海尔"按钮？

**A**: 可能的原因：
1. 不是海尔产品订单
2. 订单状态不是"已支付"
3. 订单已经推送过了

### Q2: 推送失败怎么办？

**A**: 
1. 查看错误提示
2. 检查订单信息是否完整
3. 确认海尔API配置正确
4. 稍后重试

### Q3: 如何知道订单是否推送成功？

**A**: 
1. 推送成功会显示成功提示
2. "海尔订单"列显示"已推送"
3. 订单详情中显示海尔订单号
4. "推送海尔"按钮变为"查询物流"

### Q4: 可以重复推送吗？

**A**: 
不可以。每个订单只能推送一次，推送成功后按钮会消失。

### Q5: 物流信息什么时候更新？

**A**: 
物流信息由海尔系统提供，更新时间取决于海尔系统。建议定期查询。

## 技术说明

### API端点

```typescript
// 推送订单到海尔
POST /api/orders/{id}/push_to_haier/
{
  "source_system": "MERCHANT_ADMIN",
  "shop_name": "默认店铺"
}

// 查询海尔物流
GET /api/orders/{id}/haier_logistics/
```

### 数据结构

```typescript
// 订单响应
{
  id: number;
  order_number: string;
  is_haier_order: boolean;  // 是否海尔订单
  haier_order_info: {       // 海尔订单信息
    haier_order_no: string;  // 海尔订单号
    haier_so_id: string;     // 海尔子订单号
    haier_status: string;    // 海尔订单状态
    product_code: string;    // 产品编码
  } | null;
  logistics_info: {         // 物流信息
    logistics_company: string;
    logistics_no: string;
    delivery_record_code: string;
    sn_code: string;
  } | null;
}
```

## 更新日志

- 2025-01-01: 初始版本，添加海尔订单推送和物流查询功能

## 支持

如有问题，请联系技术支持。
